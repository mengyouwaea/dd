<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml">
{% load static %}
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<script src="{% static 'js/jquery-1.8.3.min.js' %}"></script>
<link rel="shortcut icon" href="images/favicon.ico?v=20160901" type="image/x-icon">
<link href="{% static 'css/shopping_cart_new.css' %}" rel="stylesheet" type="text/css">
<link href="{% static 'css/footer_150526.css' %}" rel="stylesheet" type="text/css" />
</head>

<body style="padding-bottom:82px">
<link href="{% static 'css/header_960_150611.css' %}" rel="stylesheet" type="text/css">
<script src="{% static 'js/pagetop2015_0827.js' %}" charset="gb2312" type="text/javascript"></script>
<script src="{% static 'js/jquery-1.8.3.min.js' %}"></script>
<script src="{% static 'js/jquery-latest.js' %}"></script>
<script>
    var a=0;
    var b=0;
    var c=0;
    var d=0;
{#   验证用户名不能为空 #}
    function recipient_name(one) {
        if($(one).val()){
            $("#spn_ship_man").text("");
            a=1
        }else{
            $("#spn_ship_man").text("收货人不能为空！");
            $("#spn_ship_man").css("color","red");
        }
    }
{#    验证详细地址不能为空#}
    function verfiy_addr(a) {
        if($(a).val()==''){
            $("#addr_tss").text("详细地址不能为空")
            $("#addr_tss").css("color","red")
        }else{
            b=1;
        }
    }

{#    验证邮编格式是否正确#}
    function verfiy_zip(a) {
        var rules=/^[1-9]\d{5}(?!\d)/;
        console.log(rules.test($(a).val()));
        console.log(rules.test($(a).val()==false));
        if(rules.test($(a).val())){
            $("#zip_ts").text("");
            c=1;
        }else{
            $("#zip_ts").text("邮编不正确,请重新输入，邮箱格式为：六位数字例如：北京大兴区：102600");
            $("#zip_ts").css("color","red")
        }
    }
{#    手机号码格式和不能为空验证#}
    function verfiy_cellphone(a) {
        var rules=/^[1][3,4,5,7,8,9][0-9]{9}$/;
        console.log(rules.test($(a).val()));
        if(rules.test($(a).val())){
            d=1;
            $("#cell_ts").text("电话格式为0开头，例如010-1232323(7或8位)");
        }else{
            $("#cell_ts").text("手机号码不正确,请重新输入");
            $("#cell_ts").css("color","red")
        }
    }
{#    电话可以为空但是如果不为空格式一定要正确#}
    function verfiy_phone(a) {
        var rules=/^0\d{2,3}-\d{7,8}$/;
        if($(a).val()==''){
            $("#cell_ts").text("电话格式为0开头，例如010-1232323(7或8位)")
        }else if(rules.test($(a).val())){
            $("#cell_ts").text()
        }else{
            $("#cell_ts").text("电话格式不正确");
            $("#cell_ts").css("color","red")
        }
    }

{#    改变地址做相应改变#}
    $(function () {
        $("#auto_addr").change(function () {
            var csrf_token="{{ csrf_token }}";
            $.ajaxSetup({headers:{"X-CSRFToken":csrf_token}});
            $.post(
                '{% url 'shopping:auto_addr' %}',
                'id='+$("#auto_addr").val(),
                function (abc) {
                    console.log(abc)
                    var addrs=abc.addr;
                    console.log(addrs);
                    if(addrs){
                        var address=addrs[0];
                        $("#man").val(address.recipient);
                        $("#address").val(address.recipient_addr);
                        $("#zips").val(address.zip);
                        $("#cell").val(address.cell_phone);
                        $("#phone").val(address.phone_number);
                        a=1;
                        b=1;
                        c=1;
                        d=1
                    }else{
                        $("#man").val('');
                        $("#address").val('');
                        $("#zips").val('');
                        $("#cell").val('');
                        $("#phone").val('');
                        a=0
                        b=0
                        c=0
                        d=0
                    }
                }
            );
        });
    });
 {#    当所有验证通过之后点击提交时候触发form的submit#}
    function tj() {
        console.log("好像好想");
        if(a==1&&b==1&&c==1&&d==1){
            console.log("想我了，还不来看我，哼")
            $("#tj").submit();
        }
    }
</script>

<div id="hd">
<div id="tools">
<div class="tools">
    <div class="ddnewhead_operate" dd_name="顶链接">
        
        <div class="ddnewhead_welcome" display="none;">
            <span id="nickname">
                {% if request.session.name or request.COOKIES.namereme %}
                    <span class="hi hi_none">欢迎{{request.session.name  }}{{ request.COOKIES.namereme }}宝宝光临当当</span>
                    <a href="{% url 'lr:exits' %}" class="login_link">退出</a>
                    <a href="{% url 'show:index_show' %}">返回首页</a>
                {% else %}
                    <span>欢迎光临当当！</span>
                    <a href="{% url 'lr:login_view' %}" class="login_link">登录</a>
                    <a href="{% url 'lr:regist_view' %}" class="login_link">免费注册</a>
                {% endif %}
            </span>
            <div class="tel_pop" style="display:none" id="__ddnav_sjdd" onmouseover="showgaoji('a_phonechannel','__ddnav_sjdd');" onmouseout="hideotherchannel('a_phonechannel','__ddnav_sjdd');">
                <a target="_blank" href="http://t.dangdang.com/20130220_ydmr" class="title"><i class="icon_tel"></i>手机当当</a><i class="title_shadow"></i>
                <ul class="tel_pop_box">
                    <li><a href="http://t.dangdang.com/20130220_ydmr" dd_name="手机二维码"><span>当当手机客户端</span><img src="http://img3.ddimg.cn/00363/doc/erweima2.png"><span class="text">随手查订单<br>随时享优惠</span></a></li>
                </ul>
            </div>
        </div>
        <div class="new_head_znx" id="znx_content" style="display:none;"></div>
    </div>
</div>
</div>
<div id="header_end"></div>
<!--CreateDate  2016-09-28 11:30:01--></div>
<form action="http://search.dangdang.com/search.aspx" id="bootpagetopSearch" name="bootpagetopSearch" method="GET"></form>
<script type="text/javascript">var nick_num = 0;initHeaderOperate();</script><script type="text/javascript" src="http://orderb.dangdang.com/queryunpaid?callback=Unpaid_Data"></script>
		<div class="shoppingcart_wrapper" id="ad_cpt_11850"><div><a href="http://a.dangdang.com/tjump.php?q=ddo84XQOf357bOs8tXGg5%2F%2F0oVoDImt3DFWsMqu7ZMSVsfUMeOQJueASNiMLjq%2FdrXMLCKnVfyKEahteAh1ih%2ByKYrKGzhvL20LVbDzObRambBA0YPpivy5hR5foQ4Rt%2BTB" target="_blank" rel="nofollow"><img src="http://img62.ddimg.cn/2017/1/11/2017011111344969879.jpg"></a></div></div>
<div class="logo_line">
    <div class="w960">
        <div class="shopping_procedure01 shopping_procedure "><span>我的购物车</span><span class="current">填写订单</span><span>完成订单</span></div>
        <div class="logo"><a href="#"><img src="images/bz_logo_car.jpg" alt=""></a></div>
    </div>
</div>
<div class="indent_con">
	<div class="shdz">

        <form action="{% url 'shopping:indent_ok' %}" id="tj" method="post" >
            {% csrf_token %}
            <div class="address" id="dp_adress">
                <span class="icon_adr">&nbsp;</span>配送地址：
                     <select name="address" id="auto_addr">
                     {% if addrs %}
                        <option value="">请输入新地址</option>
                        {% for addr in addrs %}
                            <option value="{{ addr.id}}">{{ addr.recipient }}</option>
                        {% endfor %}
                     {% else %}
                         <option value="">请输入新地址</option>
                     {% endif %}

                     </select>
                <!--<a href="#" class="tip"></a>-->
                <span class="tip_c" style="display:none;">针对不同配送地址，您的货物可能出现缺货或无货状态，敬请谅解。</span>

            </div>
            <h3>收货相关信息</h3>
            <ul class="shdz_con">
                <p>▪ 收货地址</p>
                <li><label><strong>*</strong>收&nbsp;&nbsp;货&nbsp;&nbsp;人：</label><input type="text" name="recipient" onblur="recipient_name(this);" value="" id="man"><span id="spn_ship_man" class="hint new_tip" style="display: block;">请填写收货人姓名</span></li>
                <li>
                    <label><strong>*</strong>收货地区：</label>
{#                    <input type="text" name="province" placeholder="请写入省份" id="province">#}
{#                    <input type="text" name="city" placeholder="请写入市" id="city">#}
{#                    <input type="text" name="county" placeholder="请写入县" id="county">#}
                    <select id="country_id" name="country_id" onfocus="check_focus('spn_country_province_city');" onblur="check_country_province_city();" onchange="set_province(this.options[this.selectedIndex].value);" style="display: block;"><option value="9000">中国</option><option value="16767">阿尔及利亚</option><option value="11717">阿根廷</option><option value="16161">阿联酋</option><option value="12020">埃及</option><option value="12525">爱尔兰</option><option value="11919">奥地利</option><option value="10909">澳大利亚</option><option value="14747">巴基斯坦</option><option value="12828">巴拿马</option><option value="10707">巴西</option><option value="16868">白俄罗斯</option><option value="16969">保加利亚</option><option value="13535">比利时</option><option value="15656">波多黎各</option><option value="14949">波兰</option><option value="17272">玻利维亚</option><option value="14444">丹麦</option><option value="10505">德国</option><option value="15353">俄罗斯</option><option value="10404">法国</option><option value="12222">菲律宾</option><option value="12323">芬兰</option><option value="17474">古巴</option><option value="12424">关岛</option><option value="10808">韩国</option><option value="12121">荷兰</option><option value="11010">加拿大</option><option value="15151">柬埔寨</option><option value="11111">捷克</option><option value="17373">喀麦隆</option><option value="14848">科威特</option><option value="15858">老挝</option><option value="16262">黎嫩</option><option value="15959">列支敦士登</option><option value="16060">卢森堡</option><option value="17070">卢旺达</option><option value="13030">罗马尼亚</option><option value="15555">马尔代夫</option><option value="13636">马来西亚</option><option value="10101">美国</option><option value="14545">蒙古</option><option value="17171">孟加拉</option><option value="11818">秘鲁</option><option value="11212">墨西哥</option><option value="13232">南非</option><option value="16666">南斯拉夫</option><option value="16363">尼日利亚</option><option value="11313">挪威</option><option value="12929">葡萄牙</option><option value="10303">日本</option><option value="11414">瑞典</option><option value="13737">瑞士</option><option value="13838">塞浦路斯</option><option value="16464">沙特阿拉伯</option><option value="13333">斯里兰卡</option><option value="13434">泰国</option><option value="13939">坦桑尼亚</option><option value="15757">土耳其</option><option value="15252">委内瑞拉</option><option value="15050">文莱</option><option value="14040">乌克兰</option><option value="16565">乌拉圭</option><option value="11515">西班牙</option><option value="14343">希腊</option><option value="13131">新加坡</option><option value="12727">新西兰</option><option value="14141">匈牙利</option><option value="12626">牙买加</option><option value="11616">意大利</option><option value="10606">印度</option><option value="14646">印度尼西亚</option><option value="10202">英国</option><option value="14242">越南</option><option value="15454">智利</option><option value="19999">其他国家或地区</option></select>
                    <select id="province_id" name="province_id" onfocus="check_focus('spn_country_province_city');" onblur="check_country_province_city();" onchange="set_city(this.options[this.selectedIndex].value);" style="display: block;"><option value="0">--请选择--</option><option value="111">北京</option><option value="112">天津</option><option value="113">河北</option><option value="114">山西</option><option value="115">内蒙古</option><option value="121">辽宁</option><option value="122">吉林</option><option value="123">黑龙江</option><option value="131">上海</option><option value="132">江苏</option><option value="133">浙江</option><option value="134">安徽</option><option value="135">福建</option><option value="136">江西</option><option value="137">山东</option><option value="141">河南</option><option value="142">湖北</option><option value="143">湖南</option><option value="144">广东</option><option value="145">广西</option><option value="146">海南</option><option value="150">重庆</option><option value="151">四川</option><option value="152">贵州</option><option value="153">云南</option><option value="154">西藏</option><option value="161">陕西</option><option value="162">甘肃</option><option value="163">青海</option><option value="164">宁夏</option><option value="165">新疆</option><option value="171">台湾</option><option value="172">香港</option><option value="173">澳门</option><option value="33">其他省份</option></select>
                        <select id="city_id" name="city_id"><option value="0">请选择</option></select>
                        <select id="town_id" name="town_id" ><option value="0">请选择</option></select>
                        <select id="quarter_id" name="quarter_id" ><option value="0">请选择</option></select></li>
                <li><label><strong>*</strong>详细地址：</label><input type="text" name="detail_addr" onblur="verfiy_addr(this); " id="address" ><span id="addr_tss"></span></li>
                <li><label><strong>*</strong>邮政编码：</label><input type="text" name="zip"  onblur="verfiy_zip(this);" id="zips"><span id="zip_ts">邮箱格式为：六位数字例如：北京大兴区：102600</span></li>
                <li><label><strong>*</strong>手&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;机：</label><input id="cell" type="text" name="cell_phone" onblur="verfiy_cellphone(this);"><label>或&nbsp;&nbsp;固定电话</label><input id="phone" type="text" name="phone_number" onblur="verfiy_phone(this);"><span id="cell_ts">请输入手机号码或者电话格式为0开头，例如010-1232323(7或8位)</span></li>
            </ul>
            <div class="balance"><p>商品金额：¥{{ car.total_price }}</p><p class="yfze">应付总额（含运费）：<em>¥{{ car.total_price }}</em></p><p><a href="javascript:void(0);" onclick="tj();" >提交订单</a></p></div>
        </form>
    </div>
    <div class="shdz">
    	<h3>订单1（百知网配送）</h3>
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tbody>
                <tr style="height:30px; line-height:30px;">
                    <th width="34%">商品名称</th>
                    <th width="11%">所在仓库</th>
                    <th width="13%">百知价</th>
                    <th width="11%">促销价</th>
                    <th width="9%">数量</th>
                    <th width="11%">小计</th>
                    <th width="11%">操作</th>
                </tr>
                {% for books in car.cartitems %}
                    <tr>
                    <td>{{ books.book.book_name }}（独家萌宠便利贴版）</td>
                    <td align="center">当当仓库</td>
                    <td align="center">¥{{ books.book.ddpriice }}（{% widthratio books.book.ddpriice books.book.pricing 10 %}折）</td>
                    <td align="center">--</td>
                    <td align="center">{{ books.amount }}</td>
                    <td align="center">¥{% widthratio books.book.ddpriice 1 books.amount %}</td>
                    <td align="center"><a href="">放回购物车</a></td>
                </tr>
                {% endfor %}
                 <tr>
                    <td colspan="2"><input type="checkbox" >此订单作为礼品赠送他人</td>
                    <td colspan="2"><strong>运费：</strong>当确认送货方式后显示</td>
                    <td class="table_zj" colspan="3"><strong>小计总额：</strong><em>¥{{ car.total_price }}</em></td>
                </tr>
            </tbody>
        </table>
    </div>
     
</div>

<div id="footer">
<div class="footer">
	<div class="footer_nav_box">
		<div class="footer_copyright"><span>Copyright (C) 当当网 2004-2014, All Rights Reserved</span><a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001051000098" target="_blank" class="footer_img" rel="nofollow"><img src="http://img4.dangdang.com/bottom/validate.gif"></a><span><a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">京ICP证041189号</a></span><span>出版物经营许可证&nbsp;新出发京批字第直0673号</span></div>
	</div>
</div>
</div>
    <div class="foot_tip_ad">广告</div>
    <style>
        .foot_tip_ad { width:40px; height:40px; font:12px/40px "simsun"; text-align:center; color:#fff; background-color:#474747; position:fixed; right:0; bottom:10px;_position:absolute; _bottom:auto;_top:expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0)));}
    </style>


</body>
</html>
